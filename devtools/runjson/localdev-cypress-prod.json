[
  {
    "Name": "Build-BE",
    "Command": ["make", "-s", "bin/goalert", "BUNDLE=1"],
    "Restart": true,
    "Quiet": true,
    "IgnoreErrors": true
  },
  {
    "Name": "Backend",
    "Command": [
      "bin/procwrap",
      "-test=localhost:3042",
      "bin/goalert",
      "-l=localhost:3042",
      "--db-url=postgres://postgres@localhost:5433/postgres?sslmode=disable",
      "--slack-base-url=http://localhost:3040/slack",
      "--twilio-base-url=http://localhost:3040/twilio",
      "--log-errors-only"
    ],
    "Restart": true,
    "IgnoreErrors": true,
    "Watch": true,
    "Before": {
      "Name": "PG Wait",
      "Command": [
        "bin/waitfor",
        "postgres://postgres@localhost:5433/postgres?sslmode=disable"
      ]
    }
  },
  {
    "Name": "Twilio",
    "Restart": true,
    "Watch": true,
    "Command": [
      "bin/mocktwilio",
      "-account-sid=AC00000000000000000000000000000000",
      "-auth-token=11111111111111111111111111111111",
      "-sms=+17635550123=http://localhost:3040/api/v2/twilio/message",
      "-voice=+17635550123=http://localhost:3040/api/v2/twilio/call",
      "-prefix=/twilio",
      "-addr=localhost:3047"
    ]
  },
  {
    "Name": "Slack",
    "Restart": true,
    "Watch": true,
    "Command": [
      "bin/mockslack",
      "-client-id=000000000000.000000000000",
      "-client-secret=00000000000000000000000000000000",
      "-access-token=xoxp-000000000000-000000000000-000000000000-00000000000000000000000000000000",
      "-prefix=/slack",
      "-single-user=bob",
      "-addr=localhost:3046"
    ]
  },
  {
    "Name": "Proxy",
    "Command": [
      "bin/simpleproxy",
      "-addr=localhost:3040",
      "/slack/=http://localhost:3046",
      "/twilio/=http://localhost:3047",
      "http://localhost:3042"
    ]
  },
  {
    "Name": "Postgres",
    "Before": {
      "Name": "PG Cleanup",
      "Command": ["docker", "rm", "-f", "smoketest-postgres"],
      "IgnoreErrors": true
    },
    "After": {
      "Name": "PG Cleanup",
      "Command": ["docker", "rm", "-f", "smoketest-postgres"],
      "IgnoreErrors": true
    },
    "Command": [
      "docker",
      "run",
      "--rm",
      "--name=smoketest-postgres",
      "-e=POSTGRES_HOST_AUTH_METHOD=trust",
      "-p=5433:5432",
      "postgres:11-alpine"
    ]
  },
  {
    "Name": "Cypress",
    "Before": {
      "Name": "BE Wait",
      "Command": ["bin/waitfor", "http://localhost:3042"]
    },
    "Command": [
      "./node_modules/.bin/cypress",
      "$CY_ACTION",
      "--config",
      "baseUrl=http://localhost:3040$GOALERT_HTTP_PREFIX",
      "--browser",
      "$CY_BROWSER"
    ],
    "Env": [
      "CYPRESS_DB_URL=postgres://postgres@localhost:5433/postgres?sslmode=disable"
    ],
    "Dir": "web/src",
    "ExitAfter": true
  }
]
